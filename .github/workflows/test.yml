name: Test

on:
  push:
  workflow_dispatch:
  workflow_run:
    workflows:
      - build
    types:
      - completed

jobs:
  test:
    name: Test
    runs-on: ubuntu-latest
    steps:
      - name: Print env
        run: env
      - name: Print github context
        env:
          GITHUB_CONTEXT: ${{ toJson(github) }}
        run: echo "$GITHUB_CONTEXT"
      - name: Checkout
        uses: actions/checkout@v4
      - name: Download Artifact
        if: ${{ github.event_name == 'workflow_run' }}
        uses: dawidd6/action-download-artifact@v2
        with:
          name: my-artifact
          workflow: ${{ github.event.workflow_run.workflow_id }}
          path: ${{ github.workspace }}/build
      - name: list files
        run: ls -LR
      - name: Run script
        run: python .github/scripts/test.py
      - name: Summary
        run: |
          echo "# Summary" >> $GITHUB_STEP_SUMMARY
          echo "Actor: @${{ env.ACTOR }}" >> $GITHUB_STEP_SUMMARY
      - name: Summary - push
        if: ${{ github.event_name == 'push' }}
        run: |
          echo "Head Commit: [${{ env.COMMIT_MESSAGE }}](${{ env.COMMIT_URL }})" >> $GITHUB_STEP_SUMMARY
      - name: Summary - workflow run
        if: ${{ github.event_name == 'workflow_run' }}
        run: |
          echo "Workflow Run: [$${{ github.event.workflow_run.name }}](${{ github.event.workflow_run.html_url }})" >> $GITHUB_STEP_SUMMARY
